<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Final model tuning | Spaceship Titanic - A comprehensive guide</title>
<meta name="author" content="Vanja Manborg">
<meta name="description" content="The exploration of the data has so far yielded a set of features, including second level interactions, that we think offers the best accuracy. We’ve tested them through several feature selection...">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Chapter 8 Final model tuning | Spaceship Titanic - A comprehensive guide">
<meta property="og:type" content="book">
<meta property="og:url" content="https://spaceshiptitanic.manborgconsulting.com/chapter-8.html">
<meta property="og:description" content="The exploration of the data has so far yielded a set of features, including second level interactions, that we think offers the best accuracy. We’ve tested them through several feature selection...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Final model tuning | Spaceship Titanic - A comprehensive guide">
<meta name="twitter:description" content="The exploration of the data has so far yielded a set of features, including second level interactions, that we think offers the best accuracy. We’ve tested them through several feature selection...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="libs/jquery-migrate-3.1.0/jquery-migrate-3.1.0.min.js"></script><link href="libs/slick-1.8.1/slick/slick.css" rel="stylesheet">
<link href="libs/slick-1.8.1/slick/slick-theme.css" rel="stylesheet">
<script src="libs/slick-1.8.1/slick/slick.min.js"></script><script src="libs/css-resize-1.2.1/ResizeSensor.js"></script><script src="libs/css-resize-1.2.1/ElementQueries.js"></script><link href="libs/slickR-0.0.2/slick.css" rel="stylesheet">
<link href="libs/slickR-0.0.2/slick-theme.css" rel="stylesheet">
<script src="libs/slickR-0.0.2/slickR.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script>
    /* ========================================================================
     * Bootstrap: transition.js v3.3.7
     * http://getbootstrap.com/javascript/#transitions
     * ========================================================================
     * Copyright 2011-2016 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     * ======================================================================== */


    +function ($) {
      'use strict';

      // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
      // ============================================================

      function transitionEnd() {
        var el = document.createElement('bootstrap')

        var transEndEventNames = {
          WebkitTransition : 'webkitTransitionEnd',
          MozTransition    : 'transitionend',
          OTransition      : 'oTransitionEnd otransitionend',
          transition       : 'transitionend'
        }

        for (var name in transEndEventNames) {
          if (el.style[name] !== undefined) {
            return { end: transEndEventNames[name] }
          }
        }

        return false // explicit for ie8 (  ._.)
      }

      // http://blog.alexmaccaw.com/css-transitions
      $.fn.emulateTransitionEnd = function (duration) {
        var called = false
        var $el = this
        $(this).one('bsTransitionEnd', function () { called = true })
        var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
        setTimeout(callback, duration)
        return this
      }

      $(function () {
        $.support.transition = transitionEnd()

        if (!$.support.transition) return

        $.event.special.bsTransitionEnd = {
          bindType: $.support.transition.end,
          delegateType: $.support.transition.end,
          handle: function (e) {
            if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
          }
        }
      })

    }(jQuery);
    </script><script>
    /* ========================================================================
     * Bootstrap: collapse.js v3.3.7
     * http://getbootstrap.com/javascript/#collapse
     * ========================================================================
     * Copyright 2011-2016 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     * ======================================================================== */

    /* jshint latedef: false */

    +function ($) {
      'use strict';

      // COLLAPSE PUBLIC CLASS DEFINITION
      // ================================

      var Collapse = function (element, options) {
        this.$element      = $(element)
        this.options       = $.extend({}, Collapse.DEFAULTS, options)
        this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                               '[data-toggle="collapse"][data-target="#' + element.id + '"]')
        this.transitioning = null

        if (this.options.parent) {
          this.$parent = this.getParent()
        } else {
          this.addAriaAndCollapsedClass(this.$element, this.$trigger)
        }

        if (this.options.toggle) this.toggle()
      }

      Collapse.VERSION  = '3.3.7'

      Collapse.TRANSITION_DURATION = 350

      Collapse.DEFAULTS = {
        toggle: true
      }

      Collapse.prototype.dimension = function () {
        var hasWidth = this.$element.hasClass('width')
        return hasWidth ? 'width' : 'height'
      }

      Collapse.prototype.show = function () {
        if (this.transitioning || this.$element.hasClass('in')) return

        var activesData
        var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

        if (actives && actives.length) {
          activesData = actives.data('bs.collapse')
          if (activesData && activesData.transitioning) return
        }

        var startEvent = $.Event('show.bs.collapse')
        this.$element.trigger(startEvent)
        if (startEvent.isDefaultPrevented()) return

        if (actives && actives.length) {
          Plugin.call(actives, 'hide')
          activesData || actives.data('bs.collapse', null)
        }

        var dimension = this.dimension()

        this.$element
          .removeClass('collapse')
          .addClass('collapsing')[dimension](0)
          .attr('aria-expanded', true)

        this.$trigger
          .removeClass('collapsed')
          .attr('aria-expanded', true)

        this.transitioning = 1

        var complete = function () {
          this.$element
            .removeClass('collapsing')
            .addClass('collapse in')[dimension]('')
          this.transitioning = 0
          this.$element
            .trigger('shown.bs.collapse')
        }

        if (!$.support.transition) return complete.call(this)

        var scrollSize = $.camelCase(['scroll', dimension].join('-'))

        this.$element
          .one('bsTransitionEnd', $.proxy(complete, this))
          .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
      }

      Collapse.prototype.hide = function () {
        if (this.transitioning || !this.$element.hasClass('in')) return

        var startEvent = $.Event('hide.bs.collapse')
        this.$element.trigger(startEvent)
        if (startEvent.isDefaultPrevented()) return

        var dimension = this.dimension()

        this.$element[dimension](this.$element[dimension]())[0].offsetHeight

        this.$element
          .addClass('collapsing')
          .removeClass('collapse in')
          .attr('aria-expanded', false)

        this.$trigger
          .addClass('collapsed')
          .attr('aria-expanded', false)

        this.transitioning = 1

        var complete = function () {
          this.transitioning = 0
          this.$element
            .removeClass('collapsing')
            .addClass('collapse')
            .trigger('hidden.bs.collapse')
        }

        if (!$.support.transition) return complete.call(this)

        this.$element
          [dimension](0)
          .one('bsTransitionEnd', $.proxy(complete, this))
          .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
      }

      Collapse.prototype.toggle = function () {
        this[this.$element.hasClass('in') ? 'hide' : 'show']()
      }

      Collapse.prototype.getParent = function () {
        return $(this.options.parent)
          .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
          .each($.proxy(function (i, element) {
            var $element = $(element)
            this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
          }, this))
          .end()
      }

      Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
        var isOpen = $element.hasClass('in')

        $element.attr('aria-expanded', isOpen)
        $trigger
          .toggleClass('collapsed', !isOpen)
          .attr('aria-expanded', isOpen)
      }

      function getTargetFromTrigger($trigger) {
        var href
        var target = $trigger.attr('data-target')
          || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

        return $(target)
      }


      // COLLAPSE PLUGIN DEFINITION
      // ==========================

      function Plugin(option) {
        return this.each(function () {
          var $this   = $(this)
          var data    = $this.data('bs.collapse')
          var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

          if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
          if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
          if (typeof option == 'string') data[option]()
        })
      }

      var old = $.fn.collapse

      $.fn.collapse             = Plugin
      $.fn.collapse.Constructor = Collapse


      // COLLAPSE NO CONFLICT
      // ====================

      $.fn.collapse.noConflict = function () {
        $.fn.collapse = old
        return this
      }


      // COLLAPSE DATA-API
      // =================

      $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
        var $this   = $(this)

        if (!$this.attr('data-target')) e.preventDefault()

        var $target = getTargetFromTrigger($this)
        var data    = $target.data('bs.collapse')
        var option  = data ? 'toggle' : $this.data()

        Plugin.call($target, option)
      })

    }(jQuery);
    </script><script>
    window.initializeCodeFolding = function(show) {

      // handlers for show-all and hide all
      $("#rmd-show-all-code").click(function() {
        $('div.r-code-collapse').each(function() {
          $(this).collapse('show');
        });
      });
      $("#rmd-hide-all-code").click(function() {
        $('div.r-code-collapse').each(function() {
          $(this).collapse('hide');
        });
      });

      // index for unique code element ids
      var currentIndex = 1;

      // select all R code blocks
      var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
      rCodeBlocks.each(function() {

        // create a collapsable div to wrap the code in
        var div = $('<div class="collapse r-code-collapse"></div>');
        if (show)
          div.addClass('in');
        var id = 'rcode-643E0F36' + currentIndex++;
        div.attr('id', id);
        $(this).before(div);
        $(this).detach().appendTo(div);

        // add a show code button right above
        var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
        var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
        showCodeButton.append(showCodeText);
        showCodeButton
            .attr('data-toggle', 'collapse')
            .attr('data-target', '#' + id)
            .attr('aria-expanded', show)
            .attr('aria-controls', id);

        var buttonRow = $('<div class="row"></div>');
        var buttonCol = $('<div class="col-md-12"></div>');

        buttonCol.append(showCodeButton);
        buttonRow.append(buttonCol);

        div.before(buttonRow);

        // update state of button on show/hide
        div.on('hidden.bs.collapse', function () {
          showCodeText.text('Code');
        });
        div.on('show.bs.collapse', function () {
          showCodeText.text('Hide');
        });
      });

    };
    </script><style type="text/css">
    .code-folding-btn { margin-bottom: 4px; }
    .row { display: flex; }
    .collapse { display: none; }
    .in { display:block }
    </style>
<script>
    $(document).ready(function () {
      window.initializeCodeFolding("show" === "show");
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Spaceship Titanic - A comprehensive guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="chapter-2.html"><span class="header-section-number">2</span> Early data exploration</a></li>
<li><a class="" href="chapter-3.html"><span class="header-section-number">3</span> Handle missing data</a></li>
<li><a class="" href="chapter-4.html"><span class="header-section-number">4</span> Exploration of categorical variables</a></li>
<li><a class="" href="chapter-5.html"><span class="header-section-number">5</span> Exploration of numerical variables</a></li>
<li><a class="" href="chapter-6.html"><span class="header-section-number">6</span> Interactions</a></li>
<li><a class="" href="chapter-7.html"><span class="header-section-number">7</span> Feature selection and elimination</a></li>
<li><a class="active" href="chapter-8.html"><span class="header-section-number">8</span> Final model tuning</a></li>
<li><a class="" href="chapter-9.html"><span class="header-section-number">9</span> Final results</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/MoonCastle85/SpaceshipTitanicBook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chapter-8" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Final model tuning<a class="anchor" aria-label="anchor" href="#chapter-8"><i class="fas fa-link"></i></a>
</h1>
<p>The exploration of the data has so far yielded a set of features, including second level interactions, that we think offers the best accuracy. We’ve tested them through several feature selection processes and have gotten some insight on this models performance through resampling evaluations.</p>
<p>Now we must decide which models, or assembly of models, we want to use for our final prediction. There are many different model engines that can handle classification problems, with different pros and cons. Here is a list of the ones we will be using:</p>
<div class="inline-table"><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:left;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Logistic Regression
</td>
<td style="text-align:left;">
This is the glm-model that we’ve already used. The logistic regression model is a form of linear model that uses the logit-function to transform a linear equation like <span class="math inline">\(y = \beta_0 + \beta_1x_1 + \beta_2x_2\)</span> into a logistic equation that would ensure that the probability of the outcome would stay between 0 and 1. The logit function is then used to transform the coefficients fitted to a linear model into a response that can be assigned to discrete values. To assign correct probabilities to different classes, the model uses maximal likelihood estimation.
</td>
</tr>
<tr>
<td style="text-align:left;">
Penalized logistic regression (Lasso/Ridge)
</td>
<td style="text-align:left;">
These models are based on linear regression (or logistic, in our case) but have a penalty term that is applied to the regression coefficients in order to maximize the desired metric. When the penalty is the square of the coefficients, it’s called a Rigde regression and when it’s the absolute value, it’s called the Lasso regression (least absolute shrinkage and selection operator). We have used this model in Chapter 6 to find a set of best interaction effects.
</td>
</tr>
<tr>
<td style="text-align:left;">
Generalized Additive Models (GAM)
</td>
<td style="text-align:left;">
General additive models or GAM are used to model non-linear relationships using splines which is a way to smoothly interpolate between fixed points using a set of polynomial functions. Instead of a single function that must fit to the entire range of values of a predictor against an outcome, the gam-model uses several polynomials between each spline that are connected and that better describe the relationship. It also makes best estimates for where the splines should be positioned. We have used this type of model in Chapter 5 to show the relationships between numerical variables and the outcome.
</td>
</tr>
<tr>
<td style="text-align:left;">
Support Vector Machines (SVM)
</td>
<td style="text-align:left;">
Support vector machines use mapping functions to find hyperplanes that can divide the observations into groups that most accurately fit the outcome class. To find the hyperplane that best classifies the data, the SVM-model can use different functions that are called kernels. There is a linear, polynomial and a radial kernel that we can use to see which one works best on our data.
</td>
</tr>
<tr>
<td style="text-align:left;">
Naive Bayes
</td>
<td style="text-align:left;">
<p>The Exact Bayes model would, for each row of the data, find all other rows that have the exact same set of predictor values and then predict the outcome for that row based on the most probable outcome out of that group. For most datasets, this is impractical since, with enough variables, there wouldn’t be any observations (rows) of data that were exactly the same.</p>
The Naive Bayes model assumes instead that the probabilities of each predictor can be calculated independent of the other predictors and then multiplied to get the overall probability of a certain outcome. For example, using CryoSleep and VIP from our dataset, the Naive Bayes model would calculate the probability of CryoSleep = TRUE given Transported = TRUE, which would simply be the proportion of all transported passengers that were also in cryosleep against the number of transported passengers. It would then do the same for VIP = TRUE and multiply these two probabilities with each other was well as the proportion of Transported = TRUE against the total amount of passengers. The resulting probability would then be compared to the its reverse proportions, that is, CryoSleep = TRUE and VIP = TRUE given that Transported = FALSE. The result would be that the higher probability determines how the outcome for that observation (CryoSleep = TRUE and VIP = TRUE) is predict
</td>
</tr>
<tr>
<td style="text-align:left;">
K-nearest neighbors
</td>
<td style="text-align:left;">
It has some similarity to the Naive Bayes model in the sense that the algorithm looks for k observations that have similar values and uses the outcome that the neighbors have to predict the new observation.
</td>
</tr>
<tr>
<td style="text-align:left;">
C5.0
</td>
<td style="text-align:left;">
A tree-based model that uses entropy to find the best splits in the data
</td>
</tr>
<tr>
<td style="text-align:left;">
RandomForest
</td>
<td style="text-align:left;">
<p>In a traditional tree-model, the variables are split into branches over many splits until a split point is find that minimizes some criterion, often the Gini impurity that measures the proportions of misclassified records. In the case of two classes, like in our problem, the Gini impurity is given by <span class="math inline">\(p(1-p)\)</span> where p is the proportion of missclassified records in a partition.</p>
Random forest is an extention of this but it uses random sampling of variable sets as well as records to build a forest of decision trees using bootstrap sampling and then aggregates the results across the entire forest of trees.
</td>
</tr>
<tr>
<td style="text-align:left;">
Boosted tree-model (XGBoost)
</td>
<td style="text-align:left;">
Boosting is a process of fitting a series of models into an ensamble but adding greater weights to observations whose models performed worse so that each new iteration forces the newer model to train more heavily on the obeservations that had a poorer performance.
</td>
</tr>
</tbody>
</table></div>
<div id="complete-preprocess" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Complete preprocess<a class="anchor" aria-label="anchor" href="#complete-preprocess"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s summarise the entire preprocess for the training data before we get to our models.</p>
</div>
<div id="logistic-regression---glm" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Logistic regression - GLM<a class="anchor" aria-label="anchor" href="#logistic-regression---glm"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_final_mod</span> <span class="op">&lt;-</span> <span class="fu">logistic_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glm"</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_final_wf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">final_rec</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">glm_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_control</span> <span class="op">&lt;-</span> <span class="fu">control_resamples</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># snow::clusterExport(cl = my_cluster, "int_formula")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   glm_final_fit_resamples &lt;- fit_resamples(glm_final_wf, final_folds, control = glm_control)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(glm_final_fit_resamples, file = "Extra/Final GLM tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final GLM tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bind_preds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span>.x <span class="op">=</span> <span class="va">t</span>, .f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">df</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span><span class="st">"Pred_{{x}}"</span> <span class="op">:=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.pred_True</span> <span class="op">&lt;</span> <span class="va">x</span>, <span class="st">"False"</span>, <span class="st">"True"</span><span class="op">)</span>, .keep <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">bind_cols</span><span class="op">(</span><span class="va">df</span>, <span class="va">res</span>, .name_repair <span class="op">=</span> <span class="st">"unique_quiet"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">calc_acc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"Pred"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.factor</span><span class="op">)</span>,</span>
<span>                       <span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"Pred"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="op">~</span><span class="fu">accuracy_vec</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">Transported</span>, estimate <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">glm_resample_pred</span> <span class="op">&lt;-</span> <span class="fu">collect_predictions</span><span class="op">(</span><span class="va">glm_final_fit_resamples</span>, summarize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_resample_acc</span> <span class="op">&lt;-</span> <span class="va">glm_resample_pred</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Transported</span>, <span class="va">.pred_False</span>, <span class="va">.pred_True</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">bind_preds</span><span class="op">(</span><span class="va">.</span>, <span class="va">glm_thresholds</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">calc_acc</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"Pred"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">str_split_i</span><span class="op">(</span><span class="va">name</span>, <span class="st">"_"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">glm_resample_acc</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">name</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Probability threshold"</span>, y <span class="op">=</span> <span class="st">"Accuracy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">glm_thresholds</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_thresholds2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_resample_acc2</span> <span class="op">&lt;-</span> <span class="va">glm_resample_pred</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Transported</span>, <span class="va">.pred_False</span>, <span class="va">.pred_True</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">bind_preds</span><span class="op">(</span><span class="va">.</span>, <span class="va">glm_thresholds2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">calc_acc</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"Pred"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">str_split_i</span><span class="op">(</span><span class="va">name</span>, <span class="st">"_"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">glm_resample_acc2</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">name</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Probability threshold"</span>, y <span class="op">=</span> <span class="st">"Accuracy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">glm_thresholds2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_p1</span> <span class="op">+</span> <span class="va">glm_p2</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>axis_titles <span class="op">=</span> <span class="st">"collect_y"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:glm"></span>
<img src="SpaceshipTitanicBook_files/figure-html/glm-1.png" alt="Tuning results for the GLM model." width="672"><p class="caption">
Figure 8.1: Tuning results for the GLM model.
</p>
</div>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">glm_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">glm_final_wf</span>, <span class="va">final_train</span><span class="op">)</span></span>
<span><span class="va">glm_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">glm_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Prediction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu">if_else</span><span class="op">(</span><span class="va">.pred_True</span> <span class="op">&lt;</span> <span class="fl">0.46</span>, <span class="st">"False"</span>, <span class="st">"True"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">glm_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">glm_final_pred</span><span class="op">$</span><span class="va">Prediction</span><span class="op">)</span></span></code></pre></div>
<p>Based on resamples, it seems that the best threshold for the probability cutoff is 0.46 instead of the normal 0.5. The best accuracy we seem able to get is just above 0.8 with the glm-model.</p>
</div>
<div id="penalized-logistic-regression---glmnet" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Penalized logistic regression - GLMNET<a class="anchor" aria-label="anchor" href="#penalized-logistic-regression---glmnet"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glmnet_final_mod</span> <span class="op">&lt;-</span> <span class="fu">logistic_reg</span><span class="op">(</span>penalty <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, mixture <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glmnet"</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glmnet_final_wf</span> <span class="op">&lt;-</span> <span class="va">glm_final_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">glmnet_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_acc</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">glmnet_ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">glmnet_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>mixture <span class="op">=</span> <span class="fl">1</span>, penalty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1e-07</span>, <span class="fl">1e-04</span>, <span class="fl">1e-06</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   glmnet_final_tune &lt;- glmnet_final_wf %&gt;%</span></span>
<span><span class="co">#     tune_grid(object = ., resamples = final_folds, metrics = my_acc, control = glmnet_ctrl, grid = glmnet_grid)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(glmnet_final_tune, file = "Extra/Final glmnet tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final glmnet tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_best</span><span class="op">(</span><span class="va">glmnet_final_tune</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>mixture <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mixture</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">penalty</span>, y <span class="op">=</span> <span class="va">mean</span>, label <span class="op">=</span> <span class="va">mixture</span>, colour <span class="op">=</span> <span class="va">mixture</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Final tune results"</span>, x <span class="op">=</span> <span class="st">"Lambda penalty"</span>, y <span class="op">=</span> <span class="st">"Resample accuracy"</span>, colour <span class="op">=</span> <span class="st">"Alpha"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:glmnet"></span>
<img src="SpaceshipTitanicBook_files/figure-html/glmnet-1.png" alt="Tuning results for the GLMNET model." width="672"><p class="caption">
Figure 8.2: Tuning results for the GLMNET model.
</p>
</div>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">glmnet_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_best</span><span class="op">(</span><span class="va">glmnet_final_tune</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glmnet_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">glmnet_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">glmnet_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">glmnet_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="generalized-additive-models---gam" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Generalized additive models - GAM<a class="anchor" aria-label="anchor" href="#generalized-additive-models---gam"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gam_final_mod</span> <span class="op">&lt;-</span> <span class="fu">gen_additive_mod</span><span class="op">(</span>select_features <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"mgcv"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/delete.response.html">reformulate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">final_train</span><span class="op">)</span>, <span class="st">"Transported"</span><span class="op">)</span>, response <span class="op">=</span> <span class="st">"Transported"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">gam_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span>object <span class="op">=</span> <span class="va">gam_final_mod</span>, formula <span class="op">=</span> <span class="va">f</span>, data <span class="op">=</span> <span class="va">final_train</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gam_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">gam_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">gam_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">gam_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="svm" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> SVM<a class="anchor" aria-label="anchor" href="#svm"><i class="fas fa-link"></i></a>
</h2>
<p>The parsnip package offers three different SVM engines.</p>
<p><strong>SVM_linear</strong> defines a SVM model that uses a linear class boundary. For classification, the model tries to maximize the width of the margin between classes using a linear class boundary. There is a single tuning parameter (named <em>cost</em> in parsnip) that determines how strict misclassification should be treated. The stricter the cost, the greater risk of overfitting.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svm_linear_final_mod</span> <span class="op">&lt;-</span> <span class="fu">svm_linear</span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kernlab"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svm_linear_final_wf</span> <span class="op">&lt;-</span> <span class="va">glm_final_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">svm_linear_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_acc</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">svm_linear_ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">svm_linear_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   svm_linear_final_tune &lt;- svm_linear_final_wf %&gt;%</span></span>
<span><span class="co">#     tune_grid(object = ., resamples = final_folds, metrics = my_acc, control = svm_linear_ctrl, grid = svm_linear_grid)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(svm_linear_final_tune, file = "Extra/Final SVM linear tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final SVM linear tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_best</span><span class="op">(</span><span class="va">svm_linear_final_tune</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cost</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Final tune results"</span>, x <span class="op">=</span> <span class="st">"Cost penalty"</span>, y <span class="op">=</span> <span class="st">"Resample accuracy"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:svm-linear-final"></span>
<img src="SpaceshipTitanicBook_files/figure-html/svm-linear-final-1.png" alt="Tuning results for the SVM linear model." width="672"><p class="caption">
Figure 8.3: Tuning results for the SVM linear model.
</p>
</div>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">svm_linear_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_best</span><span class="op">(</span><span class="va">svm_linear_final_tune</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Setting default kernel parameters</span></span>
<span></span>
<span><span class="va">svm_linear_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">svm_linear_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">svm_linear_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">svm_linear_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<p><strong>SVM_poly</strong> model tries to maximize the width of the margin between classes using a polynomial class boundary. There are three tuning parameters in parsnip: <em>cost</em>, <em>degree</em> and <em>scale</em>. The cost-parameter is the same as for the linear model while the degree-parameter determines the degree of the polynomial. Lower degrees might find polynomial functions that underfit while higher might overfit. The scale factor is used to scale the data and isn’t necessary if the predictors are already scaled.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svm_poly_final_mod</span> <span class="op">&lt;-</span> <span class="fu">svm_poly</span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, degree <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, scale_factor <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kernlab"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svm_poly_final_wf</span> <span class="op">&lt;-</span> <span class="va">glm_final_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">svm_poly_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_acc</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">svm_poly_ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">svm_poly_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span>, degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, scale_factor <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   svm_poly_final_tune &lt;- svm_poly_final_wf %&gt;%</span></span>
<span><span class="co">#     tune_grid(object = ., resamples = final_folds, metrics = my_acc, control = svm_poly_ctrl, grid = svm_poly_grid)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(svm_poly_final_tune, file = "Extra/Final SVM polynomial tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final SVM polynomial tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_best</span><span class="op">(</span><span class="va">svm_poly_final_tune</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">cost</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">mean</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Final tune results"</span>, x <span class="op">=</span> <span class="st">"Cost penalty"</span>, y <span class="op">=</span> <span class="st">"Resample accuracy"</span>, colour <span class="op">=</span> <span class="st">"Polynomial\ndegree"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:svm-poly-final"></span>
<img src="SpaceshipTitanicBook_files/figure-html/svm-poly-final-1.png" alt="Tuning results for the SVM poly model." width="672"><p class="caption">
Figure 8.4: Tuning results for the SVM poly model.
</p>
</div>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">svm_poly_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_best</span><span class="op">(</span><span class="va">svm_poly_final_tune</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svm_poly_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">svm_poly_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">svm_poly_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">svm_poly_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<p><strong>SVM_rbf</strong> model stands for Radial Basis Function and tries to maximize the width of the margin between classes using a nonlinear class boundary. It is useful to predictors that overlap since it maps the data into an infinite dimension space. It has two tuning parameters: <em>cost</em> and <em><span class="math inline">\(\sigma\)</span></em>. The cost-parameter is the same as for the other two SVM-models while the <span class="math inline">\(\sigma\)</span>-parameter can be seen as a weighting parameter to adjust the influence of nearby data.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svm_rbf_final_mod</span> <span class="op">&lt;-</span> <span class="fu">svm_rbf</span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kernlab"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svm_rbf_final_wf</span> <span class="op">&lt;-</span> <span class="va">glm_final_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">svm_rbf_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_acc</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">svm_rbf_ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">svm_rbf_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">1</span>, <span class="fl">1.2</span>, <span class="fl">1.8</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   svm_rbf_final_tune &lt;- svm_rbf_final_wf %&gt;%</span></span>
<span><span class="co">#     tune_grid(object = ., resamples = final_folds, metrics = my_acc, control = svm_rbf_ctrl, grid = svm_rbf_grid)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(svm_rbf_final_tune, file = "Extra/Final SVM rbf tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final SVM rbf tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_best</span><span class="op">(</span><span class="va">svm_rbf_final_tune</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cost</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Final tune results"</span>, x <span class="op">=</span> <span class="st">"Cost penalty"</span>, y <span class="op">=</span> <span class="st">"Resample accuracy"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:svm-rbf-final"></span>
<img src="SpaceshipTitanicBook_files/figure-html/svm-rbf-final-1.png" alt="Tuning results for the SVM rbf model." width="672"><p class="caption">
Figure 8.5: Tuning results for the SVM rbf model.
</p>
</div>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">svm_rbf_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_best</span><span class="op">(</span><span class="va">svm_rbf_final_tune</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svm_rbf_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">svm_rbf_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">svm_rbf_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">svm_rbf_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="naive-bayes" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Naive Bayes<a class="anchor" aria-label="anchor" href="#naive-bayes"><i class="fas fa-link"></i></a>
</h2>
<p>The Naive Bayes model has two tuning parameters in the parsnip package: <em>smoothness</em> and <em>Laplace</em>. The smoothness parameter controls the models class boundaries where lower values mean that the probabilities are more closely based on what we see in the training data while a higher value means that the probabilities are more smoothed (imagine points on a graph: low smoothness would draw a complex line through each point while high smoothness might draw a simple linear line - the best fit is probably somewhere in between).
The Laplace-parameter can be used to add a value to the probability calculations to avoid zero probabilities in cases when variables have very low frequency values or when the test data has values not present in the training data.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb_final_mod</span> <span class="op">&lt;-</span> <span class="fu">naive_Bayes</span><span class="op">(</span>smoothness <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, Laplace <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"klaR"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nb_final_wf</span> <span class="op">&lt;-</span> <span class="va">glm_final_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">nb_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_acc</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">nb_ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nb_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>smoothness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">0.5</span><span class="op">)</span>, Laplace <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   nb_final_tune &lt;- nb_final_wf %&gt;%</span></span>
<span><span class="co">#     tune_grid(object = ., resamples = final_folds, metrics = my_acc, control = nb_ctrl, grid = nb_grid)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(nb_final_tune, file = "Extra/Final Naive Bayes tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final Naive Bayes tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_best</span><span class="op">(</span><span class="va">nb_final_tune</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">smoothness</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Final tune results"</span>, x <span class="op">=</span> <span class="st">"Cost penalty"</span>, y <span class="op">=</span> <span class="st">"Resample accuracy"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:naive-bayes-final"></span>
<img src="SpaceshipTitanicBook_files/figure-html/naive-bayes-final-1.png" alt="Tuning results for the Naive Bayes model." width="672"><p class="caption">
Figure 8.6: Tuning results for the Naive Bayes model.
</p>
</div>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">nb_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_best</span><span class="op">(</span><span class="va">nb_final_tune</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nb_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">nb_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">nb_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">nb_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="knn" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> KNN<a class="anchor" aria-label="anchor" href="#knn"><i class="fas fa-link"></i></a>
</h2>
<p>We’ve already used the K-Nearest Neighbours function to impute data in <a href="chapter-3.html#chapter-3">3</a>, which uses a distance measure to determine how close a new observations is to its nearest neighbours. The model has two tuning parameters in parsnip: <em>neighbors</em> and <em>weight_func</em>. The neighbors-parameter is used to decide how many neighbours should be used for similarity comparison while the weigh_func-parameter is used to set the kernel that is used for the distance measure between the neighbours. There are a variety of kernels to choose from:</p>
<p><em>Rectangular</em>: This is also known as the uniform kernel. It gives equal weight to all neighbors within the window, effectively creating a binary situation where points are either in the neighborhood (and given equal weight) or not.
<em>Triangular</em>: This kernel assigns weights linearly decreasing from the center. It gives the maximum weight to the nearest neighbor and the minimum weight to the farthest neighbor within the window.
<em>Epanechnikov</em>: This kernel is parabolic with a maximum at the center, decreasing to zero at the window’s edge. It is often used because it minimizes the mean integrated square error.
<em>Biweight</em>: This is a smooth, bell-shaped kernel that gives more weight to the nearer neighbors.
<em>Triweight</em>: This is similar to the biweight but gives even more weight to the nearer neighbors.
<em>Cos</em>: This kernel uses the cosine of the distance to weight the neighbors.
<em>Inv</em>: This kernel gives weights as the inverse of the distance.
<em>Gaussian</em>: This kernel uses the Gaussian function to assign weights. It has a bell shape and does not compactly support, meaning it gives some weight to all points in the dataset, but the weight decreases rapidly as the distance increases.
<em>Rank</em>: This kernel uses the ranks of the distances rather than the distances themselves.</p>
<p>For our purposes, we probably want to use the rectangular kernel to keep it simple. I’m not sure if any weighting makes sense for our type of variables and response.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knn_final_mod</span> <span class="op">&lt;-</span> <span class="fu">nearest_neighbor</span><span class="op">(</span>neighbors <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, weight_func <span class="op">=</span> <span class="st">"rectangular"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"kknn"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">knn_final_wf</span> <span class="op">&lt;-</span> <span class="va">glm_final_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">knn_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_acc</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">knn_ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">knn_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>neighbors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">20</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   knn_final_tune &lt;- knn_final_wf %&gt;%</span></span>
<span><span class="co">#     tune_grid(object = ., resamples = final_folds, metrics = my_acc, control = knn_ctrl, grid = knn_grid)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(knn_final_tune, file = "Extra/Final KNN tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final KNN tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_best</span><span class="op">(</span><span class="va">knn_final_tune</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">neighbors</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Final tune results"</span>, x <span class="op">=</span> <span class="st">"Cost penalty"</span>, y <span class="op">=</span> <span class="st">"Resample accuracy"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:knn-final"></span>
<img src="SpaceshipTitanicBook_files/figure-html/knn-final-1.png" alt="Tuning results for the KNN model." width="672"><p class="caption">
Figure 8.7: Tuning results for the KNN model.
</p>
</div>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">knn_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_best</span><span class="op">(</span><span class="va">knn_final_tune</span><span class="op">)</span></span>
<span></span>
<span><span class="va">knn_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">knn_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">knn_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">knn_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="c5" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> C5<a class="anchor" aria-label="anchor" href="#c5"><i class="fas fa-link"></i></a>
</h2>
<p>The C5.0 model for decision trees for has only a single tuning parameter in parsnip: <em>min_n</em>. This parameter sets the minimal node size which is a lower boundary for how many values a node must have if it is to be split further.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c5.0_final_mod</span> <span class="op">&lt;-</span> <span class="fu">decision_tree</span><span class="op">(</span>min_n <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"C5.0"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c5.0_final_wf</span> <span class="op">&lt;-</span> <span class="va">glm_final_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">c5.0_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_acc</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">c5.0_ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">c5.0_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>min_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">24</span>, <span class="fl">48</span>, <span class="fl">72</span>, <span class="fl">96</span>, <span class="fl">120</span>, <span class="fl">144</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   c5.0_final_tune &lt;- c5.0_final_wf %&gt;%</span></span>
<span><span class="co">#     tune_grid(object = ., resamples = final_folds, metrics = my_acc, control = c5.0_ctrl, grid = c5.0_grid)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(c5.0_final_tune, file = "Extra/Final C5_0 tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final C5_0 tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_best</span><span class="op">(</span><span class="va">c5.0_final_tune</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">min_n</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Final tune results"</span>, x <span class="op">=</span> <span class="st">"Minimum values in leaf node"</span>, y <span class="op">=</span> <span class="st">"Resample accuracy"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:c5-final"></span>
<img src="SpaceshipTitanicBook_files/figure-html/c5-final-1.png" alt="Tuning results for the C5.0 model." width="672"><p class="caption">
Figure 8.8: Tuning results for the C5.0 model.
</p>
</div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">c5.0_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_best</span><span class="op">(</span><span class="va">c5.0_final_tune</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c5.0_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">c5.0_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">c5.0_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">c5.0_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="randomforest" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> RandomForest<a class="anchor" aria-label="anchor" href="#randomforest"><i class="fas fa-link"></i></a>
</h2>
<p>This model has three tuning parameters: <em>mtry</em>, <em>trees</em> and <em>min_n</em>. The mtry-parameter sets the number of randomly selected predictors used to initiate each tree in the forest while the tree-parameter sets the maximum number of trees that are to be used. The min_n is the same as for the C5.0 model and decides the lowest number of values that must be present in a node so that it is allowed to be split.
We will leave the mtry-parameter to its default value.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_min_n</span> <span class="op">&lt;-</span> <span class="fu">select_best</span><span class="op">(</span><span class="va">c5.0_final_tune</span><span class="op">)</span><span class="op">$</span><span class="va">min_n</span></span>
<span></span>
<span><span class="va">rf_final_mod</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span>trees <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, min_n <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">my_min_n</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"randomForest"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_final_wf</span> <span class="op">&lt;-</span> <span class="va">glm_final_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">rf_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_acc</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">rf_ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span>, parallel_over <span class="op">=</span> <span class="st">"resamples"</span><span class="op">)</span></span>
<span><span class="va">rf_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>trees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">800</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   rf_final_tune &lt;- rf_final_wf %&gt;%</span></span>
<span><span class="co">#     tune_grid(., resamples = final_folds, metrics = my_acc, control = rf_ctrl, grid = rf_grid)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(rf_final_tune, file = "Extra/Final randomForest tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final randomForest tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_best</span><span class="op">(</span><span class="va">rf_final_tune</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">trees</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Tune results for RandomForest"</span>, x <span class="op">=</span> <span class="st">"Number of trees"</span>, y <span class="op">=</span> <span class="st">"Resample accuracy"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:randomForest-tune"></span>
<img src="SpaceshipTitanicBook_files/figure-html/randomForest-tune-1.png" alt="Tuning results for the RandomForest model." width="672"><p class="caption">
Figure 8.9: Tuning results for the RandomForest model.
</p>
</div>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">rf_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_best</span><span class="op">(</span><span class="va">rf_final_tune</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">rf_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">rf_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">rf_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="xgboost" class="section level2" number="8.10">
<h2>
<span class="header-section-number">8.10</span> XGBoost<a class="anchor" aria-label="anchor" href="#xgboost"><i class="fas fa-link"></i></a>
</h2>
<p>XGBoost is a very complicated tree-based model that uses boosting where each iteration, the results of the previous iteration are used as inputs to tweak the next ensamble of trees. It has 8 tuning parameters in the parsnip package: <em>tree_depth</em>, <em>trees</em>, <em>learn_rate</em>, <em>mtry</em>, <em>min_n</em>, <em>loss_reduction</em>, <em>sample_size</em> and <em>stop_iter</em>. We can use the best values from previous tree-models for some of these and leave others to their defaults.</p>
<p>The ones we will tune is the tree depth, the learn-rate and the loss reduction. The tree depth sets the maxim number of splits within each tree. The learn-rate determines how large steps between boosting iterations the model takes. The larger the steps, the better the performance but the model may miss an important solution. The loss reduction determines the minimum loss that is required to further split a node of a tree. High values lead to less overfitting but also a higher risk of underfitting while low values increase the risk of overfitting.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_min_n</span> <span class="op">&lt;-</span> <span class="fu">select_best</span><span class="op">(</span><span class="va">c5.0_final_tune</span><span class="op">)</span><span class="op">$</span><span class="va">min_n</span></span>
<span><span class="va">my_trees</span> <span class="op">&lt;-</span> <span class="fu">select_best</span><span class="op">(</span><span class="va">rf_final_tune</span><span class="op">)</span><span class="op">$</span><span class="va">trees</span></span>
<span></span>
<span><span class="va">xgb_final_mod</span> <span class="op">&lt;-</span> <span class="fu">boost_tree</span><span class="op">(</span>tree_depth <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, learn_rate <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, loss_reduction <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                            min_n <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">my_min_n</span>, trees <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">my_trees</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xgb_final_wf</span> <span class="op">&lt;-</span> <span class="va">glm_final_wf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">xgb_final_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_acc</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="va">xgb_ctrl</span> <span class="op">&lt;-</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">xgb_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>tree_depth <span class="op">=</span> <span class="fl">3</span>, learn_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.02</span><span class="op">)</span>, loss_reduction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># my_cluster &lt;- snow::makeCluster(detectCores() - 1, type = 'SOCK')</span></span>
<span><span class="co"># registerDoSNOW(my_cluster)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># system.time({</span></span>
<span><span class="co">#   set.seed(8584)</span></span>
<span><span class="co">#   xgb_final_tune &lt;- xgb_final_wf %&gt;%</span></span>
<span><span class="co">#     tune_grid(., resamples = final_folds, metrics = my_acc, control = xgb_ctrl, grid = xgb_grid)</span></span>
<span><span class="co"># })</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># save(xgb_final_tune, file = "Extra/Final XGBoost tune.RData")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># snow::stopCluster(my_cluster)</span></span>
<span><span class="co"># unregister()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Extra/Final XGBoost tune.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show_best</span><span class="op">(</span><span class="va">xgb_final_tune</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span>, n <span class="op">=</span> <span class="fl">110</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">learn_rate</span>, y <span class="op">=</span> <span class="va">mean</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">loss_reduction</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Tune results for XGBoost"</span>, x <span class="op">=</span> <span class="st">"Learn rate"</span>, y <span class="op">=</span> <span class="st">"Resample accuracy"</span>, colour <span class="op">=</span> <span class="st">"Loss\nreduction"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:xgboost-final"></span>
<img src="SpaceshipTitanicBook_files/figure-html/xgboost-final-1.png" alt="Tuning results for the XGBoost model." width="672"><p class="caption">
Figure 8.10: Tuning results for the XGBoost model.
</p>
</div>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8584</span><span class="op">)</span></span>
<span><span class="va">xgb_final_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_best</span><span class="op">(</span><span class="va">xgb_final_tune</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xgb_final_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">xgb_final_fit</span>, <span class="va">final_test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">xgb_final_acc</span> <span class="op">&lt;-</span> <span class="fu">accuracy_vec</span><span class="op">(</span><span class="va">final_test</span><span class="op">$</span><span class="va">Transported</span>, <span class="va">xgb_final_pred</span><span class="op">$</span><span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chapter-7.html"><span class="header-section-number">7</span> Feature selection and elimination</a></div>
<div class="next"><a href="chapter-9.html"><span class="header-section-number">9</span> Final results</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapter-8"><span class="header-section-number">8</span> Final model tuning</a></li>
<li><a class="nav-link" href="#complete-preprocess"><span class="header-section-number">8.1</span> Complete preprocess</a></li>
<li><a class="nav-link" href="#logistic-regression---glm"><span class="header-section-number">8.2</span> Logistic regression - GLM</a></li>
<li><a class="nav-link" href="#penalized-logistic-regression---glmnet"><span class="header-section-number">8.3</span> Penalized logistic regression - GLMNET</a></li>
<li><a class="nav-link" href="#generalized-additive-models---gam"><span class="header-section-number">8.4</span> Generalized additive models - GAM</a></li>
<li><a class="nav-link" href="#svm"><span class="header-section-number">8.5</span> SVM</a></li>
<li><a class="nav-link" href="#naive-bayes"><span class="header-section-number">8.6</span> Naive Bayes</a></li>
<li><a class="nav-link" href="#knn"><span class="header-section-number">8.7</span> KNN</a></li>
<li><a class="nav-link" href="#c5"><span class="header-section-number">8.8</span> C5</a></li>
<li><a class="nav-link" href="#randomforest"><span class="header-section-number">8.9</span> RandomForest</a></li>
<li><a class="nav-link" href="#xgboost"><span class="header-section-number">8.10</span> XGBoost</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/MoonCastle85/SpaceshipTitanicBook/blob/master/07-models.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/MoonCastle85/SpaceshipTitanicBook/edit/master/07-models.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Spaceship Titanic - A comprehensive guide</strong>" was written by Vanja Manborg. It was last built on 2024-02-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
